/*!
 * jQuery.AudioPlayer.js 1.0.2 @Author Keystion
 * build time: Fri Jan 06 2017 16:38:14 GMT+0800 (CST)
 * https://github.com/Keystion/jQuery.AudioPlayer.js
*/
!function(e){"use strict";var t={options:{debuggers:!1,container:"body",source:"",imagePath:"./image",seekNum:0,allowSeek:!0,canplayCallback:null,onloadstartCallback:null,playCallback:null,pauseCallback:null,timeupdateCallback:null,seekedCallback:null,endedCallback:null,mutedCallback:null,template:$('<div id="componentWrapper"><audio id="audio-element" style="display: none;">\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 audio \u6807\u7b7e\u3002</audio><div class="controls_toggle"><img src="" alt="controls_toggle" /></div><div class="player_mediaTime_current">00:00</div><div class="player_progress"><div class="progress_bg"></div><div class="load_progress"></div><div class="play_progress"></div><div class="player_progress_tooltip"><p></p></div></div><div class="player_mediaTime_total">00:00</div><div class="player_volume_wrapper"><div class="player_volume"><img src="" alt="player_volume" /></div><div class="volume_seekbar"><div class="volume_bg"></div><div class="volume_level"></div><div class="player_volume_tooltip"><p></p></div></div></div></div>')},elements:{},init:function(e){var t=this;return e&&e.container?(this.options=$.extend(this.options,e),t.elements.audioDom=t.options.template.find("audio")[0],t.elements.componentWrapper=t.options.template.find("#componentWrapper"),t.elements.playButton=t.options.template.find(".controls_toggle"),t.elements.currentTime=t.options.template.find(".player_mediaTime_current"),t.elements.totalTime=t.options.template.find(".player_mediaTime_total"),t.elements.loadProgress=t.options.template.find(".load_progress"),t.elements.playProgress=t.options.template.find(".play_progress"),t.elements.playProgressWrap=t.options.template.find(".player_progress"),t.elements.totalPlayProgress=t.options.template.find(".progress_bg"),t.elements.mutedButton=t.options.template.find(".player_volume"),t.elements.volumeWrap=t.options.template.find(".volume_seekbar"),t.elements.totalVolume=t.options.template.find(".volume_bg"),t.elements.currentVolume=t.options.template.find(".volume_level"),t.elements.tipsVolume=t.options.template.find(".player_volume_tooltip"),$(t.options.container).append(t.options.template),t.elements.playButton.find("img").attr("src",t.options.imagePath+"/play.png"),t.elements.mutedButton.find("img").attr("src",t.options.imagePath+"/volume.png"),e.source&&t.updateSource({source:e.source,callback:function(){t.log("The audio source has been updated")}}),t.elements.currentVolume.width(.6*t.elements.audioDom.volume*100+"px"),void t.events()):!1},updateSource:function(e){var t=this;t.reset(),t.elements.audioDom.setAttribute("src",e.source),"function"==typeof e.callback&&e.callback()},events:function(){var e=this;$(window).resize(function(t){e.setLoadProgressWidth(),e.elements.playProgress.width(e.elements.audioDom.currentTime/e.elements.audioDom.duration*$(".progress_bg").width())}),e.elements.volumeWrap.on("mouseenter",function(e){e.preventDefault()}).on("mouseleave",function(t){t.preventDefault(),e.elements.tipsVolume.css("display","none"),e.setvolume()}).on("mousemove",function(t){t.preventDefault(),t.pageX-e.elements.totalVolume.offset().left>0&&t.pageX-e.elements.totalVolume.offset().left<e.elements.totalVolume.width()+1&&(e.elements.tipsVolume.css({display:"block",left:parseInt(t.pageX-e.elements.totalVolume.offset().left+e.elements.totalVolume.width()/2-40,10)+"px"}),e.elements.tipsVolume.find("p").html(e.sumVolume(t)+" %"),e.elements.currentVolume.width(t.pageX-e.elements.totalVolume.offset().left+"px"))}).on("mouseup",function(t){t.preventDefault(),e.elements.currentVolume.width(t.pageX-e.elements.totalVolume.offset().left+"px"),e.setvolume({event:t})}),e.elements.mutedButton.on("click",function(t){t.preventDefault(),e.muted()}),e.options.allowSeek?e.elements.playProgressWrap.on("mousedown",function(t){t.preventDefault(),e.elements.audioDom.paused?e.options.seekNum=1:(e.options.seekNum=2,e.pause()),e.setPlayProgressWidth(t)}).on("mousemove",function(t){t.preventDefault(),0!=e.options.seekNum&&e.setPlayProgressWidth(t)}).on("mouseup",function(t){t.preventDefault(),1==e.options.seekNum?e.pause():e.play(),e.options.seekNum=0,"function"==typeof e.options.seekedCallback&&e.options.seekedCallback({status:e.elements.audioDom.seeked})}):e.elements.playProgressWrap.on("mousedown",function(t){return t.preventDefault(),"function"!=typeof e.options.seekedCallback?(alert("\u6682\u65f6\u4e0d\u652f\u6301\u62d6\u62fd"),!1):void e.options.seekedCallback()}),e.elements.playButton.on("click",function(t){t.preventDefault(),e.toggleplay({playCallback:function(){e.log("toggleplay\uff1aplay")},pauseCallback:function(){e.log("toggleplay\uff1apause")}})}),e.elements.audioDom.onabort=function(){e.log("onabort"),e.reset()},e.elements.audioDom.oncanplay=function(){if(e.log("oncanplay"),4==e.elements.audioDom.readyState){var t=Math.round(e.elements.audioDom.duration),o=Math.floor(t/60);o=o>=10?o:"0"+o,t=Math.floor(t%60),e.elements.totalTime.html(o+":"+(t>=10?t:"0"+t)),"function"==typeof e.options.canplayCallback&&e.options.canplayCallback({status:!0})}},e.elements.audioDom.onprogress=function(){4==e.elements.audioDom.readyState&&e.elements.loadProgress.width(e.elements.audioDom.buffered.end(0)/e.elements.audioDom.seekable.end(0)*e.elements.totalPlayProgress.width())},e.elements.audioDom.onloadstart=function(){e.log("onloadstart"),"function"==typeof e.options.onloadstartCallback&&e.options.onloadstartCallback({status:!0})},e.elements.audioDom.onplay=function(){e.log("onplay"),e.elements.playButton.find("img").attr("src",e.options.imagePath+"/pause.png")},e.elements.audioDom.onpause=function(){e.log("onpause"),e.elements.playButton.find("img").attr("src",e.options.imagePath+"/play.png")},e.elements.audioDom.onended=function(){e.log("onended"),"function"==typeof e.options.endedCallback&&e.options.endedCallback({status:e.elements.audioDom.ended})},e.elements.audioDom.onseeking=function(){e.log("onseeking")},e.elements.audioDom.onseeked=function(){e.log("onseeked")},e.elements.audioDom.ontimeupdate=function(){e.log("ontimeupdate"),e.timeupdate()},e.elements.audioDom.onvolumechange=function(){e.log("onvolumechange"),e.setvolume()}},toggleplay:function(e){var t=this;t.elements.audioDom.paused?t.play(e.playCallback):t.pause(e.pauseCallback)},play:function(e){var t=this;t.elements.audioDom.play(),"function"==typeof e&&e({status:t.elements.audioDom.play}),"function"==typeof t.options.playCallback&&t.options.playCallback({status:t.elements.audioDom.play})},pause:function(e){var t=this;t.elements.audioDom.pause(),"function"==typeof e&&e({status:t.elements.audioDom.play}),"function"==typeof t.options.pauseCallback&&t.options.pauseCallback({status:t.elements.audioDom.play})},muted:function(e){var t=this;t.elements.audioDom.muted?(t.elements.audioDom.muted=!1,t.elements.mutedButton.find("img").attr("src",t.options.imagePath+"/volume.png")):(t.elements.audioDom.muted=!0,t.elements.mutedButton.find("img").attr("src",t.options.imagePath+"/mute.png")),"function"==typeof t.options.mutedCallback&&t.options.mutedCallback({status:t.elements.audioDom.muted})},setvolume:function(e){var t=this;return e?e.event?t.elements.audioDom.volume=t.sumVolume(e.event)/100:(t.options.debuggers&&console.error("\u7f3a\u5c11\u53c2\u6570\uff1aoptions.event"),!1):void t.elements.currentVolume.width(t.elements.totalVolume.width()/100*t.elements.audioDom.volume*100+"px")},setPlayProgressWidth:function(e){var t=this;return e?(t.elements.playProgress.width(e.clientX-t.elements.playProgressWrap.offset().left),void(t.elements.audioDom.currentTime=(e.clientX-t.elements.playProgressWrap.offset().left)/t.elements.totalPlayProgress.width()*t.elements.audioDom.duration)):!1},setLoadProgressWidth:function(){var e=this;4==e.elements.audioDom.readyState&&e.elements.loadProgress.width(e.elements.audioDom.buffered.end(0)/e.elements.audioDom.seekable.end(0)*e.elements.totalPlayProgress.width())},timeupdate:function(){var e=this,t=Math.floor(e.elements.audioDom.currentTime).toString(),o=Math.floor(e.elements.audioDom.duration).toString();e.elements.currentTime.html(e.formatTime(t)),isNaN(o)?e.elements.totalTime.html("00:00"):e.elements.totalTime.html(e.formatTime(o)),e.elements.playProgress.width(e.elements.audioDom.currentTime/e.elements.audioDom.duration*$(".progress_bg").width())},formatTime:function(e,t){var o=Math.floor(e/3600),l=Math.floor((e-3600*o)/60),n=Math.floor(e-3600*o-60*l);return 10>l&&(l="0"+l),10>n&&(n="0"+n),l+":"+n},sumVolume:function(e){var t=this;if(!e)return!1;var o=e.pageX-t.elements.totalVolume.offset().left;return o=Math.max(0,Math.min(1,o/t.elements.totalVolume.width())),o=parseInt(100*o,10)},reset:function(){var e=this;e.elements.playButton.find("img").attr("src",e.options.imagePath+"/play.png"),e.elements.currentTime.html("00:00"),e.elements.totalTime.html("00:00"),e.elements.currentVolume.width(e.elements.totalVolume),e.elements.playProgress.width(0),e.elements.loadProgress.width(0)},log:function(e){var t=this;return t.options.debuggers?console.info(e):void 0}};e.AudioPlayer=t}(jQuery);